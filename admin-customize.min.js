var StoryBoxController={panel:{},areaSelectionNamespace:"storyBoxController",previewIFrame:{},availableItems:[".post",".widget",".sb-element",".row",".col-md-6",".col-md-3",".site-title"],availableItemColor:"rgba(52, 152, 219,0.6)",currentItemColor:"rgba(231, 76, 60, 0.6)",setItemColor:"rgba(46, 204, 113,0.6)",currentMAP:{},entranceEffects:[],exitEffects:[],Init:function(e,t){var n=this;this.panel=e;jQuery.each(t,function(e,t){n[e]=t});this.currentMAP=JSON.parse(this.panel.find(".serializedInformation:first").val());this.panel.find(".manage").html("");this.panel.find(".description").html("<p>Available blocks will be marked with this color : </p>"+'<p style="display: block;height:20px;width:100%;background:'+this.availableItemColor+'"></p>'+"<p>Current blocks will be marked with this color : </p>"+'<p style="display: block;height:20px;width:100%;background:'+this.currentItemColor+'"></p>'+"<p>Assigned blocks will be marked with this color : </p>"+'<p style="display: block;height:20px;width:100%;background:'+this.setItemColor+'"></p>');this.panel.find(".startStoryEffect").bind("click",function(e){e.preventDefault();e.stopPropagation();n.setIFrame();n.bindAssignElement();n.panel.find(".startStoryEffect").hide();n.panel.find(".closeStoryEffect").show()});this.panel.find(".closeStoryEffect").bind("click",function(e){e.preventDefault();e.stopPropagation();n.unbindAssignElement();n.panel.find(".closeStoryEffect").hide();n.panel.find(".startStoryEffect").show();n.panel.find(".manage").html("")});this.panel.find(".clearAll").bind("click",function(e){var t=confirm("Are you sure ?");if(t==true){n.currentMAP={};n.panel.find(".closeStoryEffect").click();n.save()}})},setIFrame:function(){this.previewIFrame=jQuery("#customize-preview > iframe");this.bindAssignElement()},bindAssignElement:function(){var e=this;this.colorElementByFind(this.availableItems,this.availableItemColor);jQuery.each(this.currentMAP,function(t,n){e.colorElementByFind(e.previewIFrame.contents().find(t),e.setItemColor)});this.previewIFrame.contents().find(this.availableItems instanceof Array?this.availableItems.join(", "):this.availableItems).bind("click."+this.areaSelectionNamespace,function(t){t.preventDefault();t.stopImmediatePropagation();jQuery.each(e.availableItems instanceof Array?e.availableItems:[e.availableItems],function(t,n){e.colorElementByFind(e.previewIFrame.contents().find(n),e.availableItemColor)});jQuery.each(e.currentMAP,function(t,n){e.colorElementByFind(e.previewIFrame.contents().find(t),e.setItemColor)});var n=e._getElementInDepthPath(jQuery(this));e.setCurrentElementPath(n)})},_getElementInDepthPath:function(e){var t="";jQuery.each(this.availableItems,function(n,r){if(e.is(r))t+=r});var n=e.parent();do{t=n[0].tagName.toLowerCase()+" > "+t;n=n.parent()}while(n[0].tagName!="HTML"&&n[0].tagName!="html");return t},unbindAssignElement:function(){this.resetElementByFind(this.availableItems);this.previewIFrame.contents().find(this.availableItems instanceof Array?this.availableItems.join(", "):this.availableItems).unbind("click."+this.areaSelectionNamespace)},colorElementByFind:function(e,t){var n=this;if(e instanceof Array||typeof e=="object")jQuery.each(e,function(e,r){n._colorElement(r,t)});else this._colorElement(e,t)},_colorElement:function(e,t){this.previewIFrame.contents().find(e).css("border","3px solid "+t)},resetElementByFind:function(e){var t=this;if(e instanceof Array||typeof e=="object")jQuery.each(e,function(e,n){t._resetElement(n)});else this._resetElement(e)},_resetElement:function(e){this.previewIFrame.contents().find(e).css("border","")},setCurrentElementPath:function(e){this.colorElementByFind(e,this.currentItemColor);this._displayCurrentEffectOptions(e)},_displayCurrentEffectOptions:function(e){var t=this,n="",r=typeof this.currentMAP[e]=="undefined"?{show:[],hide:[]}:this.currentMAP[e];n+="<h2>Entrance</h2>";n+='<select name="effectControll" data-effect-type="show" style="width:100%;">';n+='<option value="0">Please Select...</option>';jQuery.each(this.entranceEffects,function(e,t){n+='<option value="'+t+'"'+(jQuery.inArray(t,r.show)!=-1?' disabled="disabled" ':"")+">"+t+"</option>"});n+="</select>";n+='<ul class="effectActiveController"  data-effect-type="show">';jQuery.each(r.show,function(e,t){n+="<li><span>"+t+'</span><a class="removeEffect" data-effect="'+t+'">Remove</a></li>'});n+="</ul>";n+="<h2>Exit ( Optional ) </h2>";n+='<select name="effectControll"  data-effect-type="hide" style="width:100%;">';n+='<option value="0">Please Select...</option>';jQuery.each(this.exitEffects,function(e,t){n+='<option value="'+t+'"'+(jQuery.inArray(t,r.hide)!=-1?' disabled="disabled" ':"")+">"+t+"</option>"});n+="</select>";n+='<ul class="effectActiveController" data-effect-type="hide">';jQuery.each(r.hide,function(e,t){n+="<li><span>"+t+'</span><a class="removeEffect" data-effect="'+t+'">Remove</a></li>'});n+="</ul>";this.panel.find(".manage").html(n);t._setPanelRemove(e);this.panel.find('.manage [name="effectControll"]').change(function(){if(jQuery(this).val()==0)return;var n=jQuery(this).val();jQuery(this).find('> option[value="'+n+'"]').attr("disabled","disabled");jQuery(this).val(0);t.panel.find('.effectActiveController[data-effect-type="'+jQuery(this).attr("data-effect-type")+'"]').append("<li><span>"+n+'</span><a class="removeEffect" data-effect="'+n+'">Remove</a></li>');t._setPanelRemove(e);t._readPanelFromInputAndSave(e)})},_setPanelRemove:function(e){var t=this;this.panel.find(".effectActiveController .removeEffect").unbind("click").bind("click",function(){t.panel.find('select[data-effect-type="'+jQuery(this).parent().parent().attr("data-effect-type")+'"] '+'> option[value="'+jQuery(this).attr("data-effect")+'"]').removeAttr("disabled");jQuery(this).parent().remove();t._readPanelFromInputAndSave(e)})},_readPanelFromInputAndSave:function(e){var t={show:[],hide:[]};this.panel.find('.manage [name="effectControll"] > option:disabled').each(function(){t[jQuery(this).parent().attr("data-effect-type")][t[jQuery(this).parent().attr("data-effect-type")].length]=jQuery(this).val()});this.setElementPathEffect(e,t.show,t.hide)},setElementPathEffect:function(e,t,n){if(jQuery.isEmptyObject(t)&&jQuery.isEmptyObject(n))delete this.currentMAP[e];else this.currentMAP[e]={show:t,hide:n};this.save()},save:function(){this.panel.find(".serializedInformation").val(JSON.stringify(this.currentMAP));this.panel.find(".serializedInformation").change()}};jQuery(document).ready(function(){var e=jQuery(".story_box_admin_element:first");if(e.length>0){var t={},n={};jQuery.each(e[0].attributes,function(e,n){t[n.name]=n.value});jQuery.each(t,function(e,t){if(e.indexOf("data-")==0){var r=e.replace("data-",""),i="";r=r.split("-");t=t.split(",");jQuery.each(r,function(e,t){i+=e==0?t:t.charAt(0).toUpperCase()+t.slice(1)});n[i]=t}});StoryBoxController.Init(e,n)}})